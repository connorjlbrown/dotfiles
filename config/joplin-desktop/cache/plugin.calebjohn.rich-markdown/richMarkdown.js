exports.default=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){"use strict";function r(e,t,n){return{name:"RichMarkdownOverlay-"+e,requiredSettings:n,token:function(n){const r=function(e,t){return e.lastIndex=t.pos,e.exec(t.string)}(t,n),i=n.baseToken();if((null==i?void 0:i.type)&&(i.type.includes("jn-inline-code")||i.type.includes("comment")||i.type.includes("katex")))n.pos+=i.size;else{if(r&&r.index===n.pos)return n.pos+=r[0].length||1,e;r?n.pos=r.index:n.skipToEnd()}return null}}}Object.defineProperty(t,"__esModule",{value:!0}),t.onSourceChanged=t.remove=t.add=t.table_regex=t.hr_regex=t.list_token_regex=t.header_regex=t.strike_token_regex=t.sup_token_regex=t.sub_token_regex=t.insert_token_regex=t.highlight_token_regex=t.strong_underline_regex=t.strong_star_regex=t.emph_underline_regex=t.emph_star_regex=t.sup_regex=t.sub_regex=t.insert_regex=t.highlight_regex=t.html_image_regex=t.image_regex=t.link_regex=t.checkbox_inner_regex=t.checkbox_regex=void 0,t.checkbox_regex=/^(\s*)([*+-] )(\[[Xx ]\])\s.*$/g,t.checkbox_inner_regex=/(?<=\[)[Xx ](?=\])/g,t.link_regex=/(?<![\\])\[[^\]]*\]\(([^\(]+)\)|<([^>\s]+\.[^>\s]+)>|(https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9]+\.[^\s]{2,}|www\.[a-zA-Z0-9]+\.[^\s]{2,}[^\)])/g,t.image_regex=/!\[[^\]]*\]\([^\(]+\)/g,t.html_image_regex=/<img([^>]+?)\/?>/g,t.highlight_regex=/(?<!\\)==(?=[^\s])[^=]*[^=\s\\]==/g,t.insert_regex=/(?<!\\)\+\+(?=[^\s])[^\+]*[^\+\s\\]\+\+/g,t.sub_regex=/(?<![\\~])~(?=[^\s])[^~]*[^~\s\\]~/g,t.sup_regex=/(?<![\\[])\^(?=[^\s])[^\^]*[^\^\s\\[]\^/g,t.emph_star_regex=/(?<![\\\*])\*(?!\*)/g,t.emph_underline_regex=/(?<![\\\_])\_(?!\_)/g,t.strong_star_regex=/(?<![\\\*])\*\*(?!\*)/g,t.strong_underline_regex=/(?<![\\\_])\_\_(?!\_)/g,t.highlight_token_regex=/(?<![\\=])==(?!=)/g,t.insert_token_regex=/(?<![\\\+])\+\+(?!\+)/g,t.sub_token_regex=/(?<![\\~])~(?!~)/g,t.sup_token_regex=/(?<![\\\^])\^(?!\^)/g,t.strike_token_regex=/(?<![\\~])~~(?!~~)/g,t.header_regex=/^\s*#+\s/g,t.list_token_regex=/^(\s*)([*+-] \[[Xx ]\]\s|[*+->]\s|(\d+)([.)]\s))(\s*)/g,t.hr_regex=/^([*\-_])(?:\s*\1){2,}\s*$/,t.table_regex=/^\|[^\n]+\|/g;const i=[r("rm-checkbox",t.checkbox_regex,[]),r("rm-checkbox-check",t.checkbox_inner_regex,["extraCSS"]),r("rm-link",t.link_regex,[]),r("rm-image",t.image_regex,[]),r("rm-image",t.html_image_regex,[]),r("rm-list-token",t.list_token_regex,[]),r("search-marker",t.highlight_regex,["markHighlight"]),r("rm-ins",t.insert_regex,["insertHighlight"]),r("rm-sub",t.sub_regex,["subHighlight"]),r("rm-sup",t.sup_regex,["supHighlight"]),r("rm-header-token",t.header_regex,["extraCSS"]),r("rm-em-token",t.emph_star_regex,["extraCSS"]),r("rm-em-token",t.emph_underline_regex,["extraCSS"]),r("rm-strong-token",t.strong_star_regex,["extraCSS"]),r("rm-strong-token",t.strong_underline_regex,["extraCSS"]),r("rm-highlight-token",t.highlight_token_regex,["extraCSS","markHighlight"]),r("rm-ins-token",t.insert_token_regex,["extraCSS","insertHighlight"]),r("rm-sub-token",t.sub_token_regex,["extraCSS","subHighlight"]),r("rm-sup-token",t.sup_token_regex,["extraCSS","supHighlight"]),r("rm-strike-token",t.strike_token_regex,["extraCSS"]),r("rm-hr line-cm-rm-hr",t.hr_regex,["extraCSS"])],o=[(s="cm-rm-code-block",(e,t,n)=>{var r,i,o;(null==n?void 0:n.outer)&&((null===(r=null==n?void 0:n.outer)||void 0===r?void 0:r.code)||(null===(o=null===(i=null==n?void 0:n.outer)||void 0===i?void 0:i.thisLine)||void 0===o?void 0:o.fencedCodeEnd))?e.addLineClass(t,"wrap",s):e.removeLineClass(t,"wrap",s)})];var s;function a(e,t){for(let n of t)if(!e[n])return!1;return!0}t.add=function(e){if(e.state.richMarkdown)for(let t of i)a(e.state.richMarkdown.settings,t.requiredSettings)&&e.addOverlay(t)},t.remove=function(e){for(let t of i)e.removeOverlay(t)},t.onSourceChanged=function(e,t,n){for(let t=e.firstLine();t<=e.lastLine();t++){const n=e.getStateAfter(t,!0);for(let r of o)r(e,t,n)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clickAt=t.getClickCoord=t.getMatchAt=t.isCheckbox=t.isLink=void 0;const r=n(0);function i(e,t,n){let r=null;if(t.lastIndex=0,!t.global)return console.error("getMatchAt requires a global regex; Consider adding a `g` after ${regex}"),null;do{if(r=t.exec(e),!r)break;const i=r.index,o=i+r[0].length;if(i<=n&&n<=o)return r}while(r);return null}t.isLink=function(e){return!!e.target&&e.target.classList.contains("cm-rm-link")},t.isCheckbox=function(e){return!!e.target&&e.target.classList.contains("cm-rm-checkbox")},t.getMatchAt=i,t.getClickCoord=function(e,t){return(n=e.coordsChar({left:t.clientX,top:t.clientY})).sticky&&"before"===n.sticky?{ch:n.ch-1,line:n.line}:n;var n},t.clickAt=function(e,t){if(!e.state.richMarkdown)return;const n=e.state.richMarkdown.settings;if(n.links){const n=function(e,t){let{line:n,ch:o}=t;const s=e.getLine(n),a=i(s,r.link_regex,o);if(!a)return;let c="";for(let e=1;e<=4;e++)c=c||a[e];c&&c.endsWith(")")?i(s,r.image_regex,o)&&(c=c.slice(0,c.length-1)):c&&(c.endsWith('"')||c.endsWith("'"))&&(c=c.slice(0,c.length-1));return c=c.split(" ")[0],c}(e,t);if(n)return{name:"followLink",url:n}}return n.checkbox&&function(e,t){const n=e.getCursor(),{line:o,ch:s}=t,a=e.getLine(o),c=i(a,r.checkbox_regex,s);if(!c||!c[3])return!1;let l=a.indexOf(c[3]),g=l+c[3].length;const u=" "===c[3][1]?"[x]":"[ ]";e.replaceRange(u,{ch:l,line:o},{ch:g,line:o},"+input"),e.setCursor(n,null,{scroll:!1})}(e,t),null}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(3),o=n(1),s=n(0),a=n(4);e.exports={default:function(e){return{plugin:function(t){function n(t){return r(this,void 0,void 0,(function*(){return yield e.postMessage({name:"getResourcePath",id:t})}))}function c(e,t){const n=e.state.richMarkdown.settings;if(!n.clickCtrl)return!0;let r=!1;return n.clickAlt&&(r=r||t.altKey),r=navigator.platform.toUpperCase().indexOf("MAC")>=0?r||t.metaKey:r||t.ctrlKey,r}function l(e,n,r){a.onRenderLine(e,n,r,t)}function g(e,t){const{from:n,to:r}=function(e){const t=e.from.line;let n=e.to.line;return n-=e.removed.length,n+=e.text.length,{from:t,to:n}}(t);i.onSourceChanged(e,n,r),s.onSourceChanged(e,n,r)}function u(e){i.afterSourceChanges(e)}function d(t,n){return r(this,void 0,void 0,(function*(){if(!t.state.richMarkdown)return;if(c(t,n)&&(o.isLink(n)||o.isCheckbox(n))){const r=o.getClickCoord(t,n),i=o.clickAt(t,r);i&&e.postMessage(i),n.preventDefault()}}))}function h(e,t,n){if(!n.target)return;let r="";(t.links&&o.isLink(n)||t.checkbox&&o.isCheckbox(n))&&(r=c(e,n)?"pointer":r);n.target.style.cursor=r}t.defineExtension("initializeRichMarkdown",(function(e){this.state.richMarkdown={settings:e,path_from_id:n},this.on("change",g),this.on("update",u),this.on("mousedown",d),this.on("renderLine",l),s.add(this),a.calculateSpaceWidth(this),e.inlineImages&&e.scanImgChangePeriod>0&&(this.state.richMarkdown.scanImgInterval=setInterval(i.refreshAllWidgets,1e3*e.scanImgChangePeriod,this)),this.updateRichMarkdownSettings(e)})),t.defineExtension("updateRichMarkdownSettings",(function(e){var t,n;this.state.richMarkdown&&(this.state.richMarkdown.settings=e,i.clearAllWidgets(this),i.onSourceChanged(this,this.firstLine(),this.lastLine()),i.afterSourceChanges(this),s.onSourceChanged(this,this.firstLine(),this.lastLine()),e.activeLine?this.setOption("styleActiveLine",{nonEmpty:!0}):this.setOption("styleActiveLine",!1),this.getWrapperElement().onmousemove=(t=this,n=e,function(e){h(t,n,e)}),this.getWrapperElement().onmouseup=function(e,t){return function(n){h(e,t,n)}}(this,e),this.state.richMarkdown.scanImgInterval&&clearInterval(this.state.richMarkdown.scanImgInterval),e.inlineImages&&e.scanImgChangePeriod>0&&(this.state.richMarkdown.scanImgInterval=setInterval(i.refreshAllWidgets,1e3*e.scanImgChangePeriod,this)))})),t.defineExtension("clickUnderCursor",(function(){const t=this.getCursor("head"),n=o.clickAt(this,t);n&&e.postMessage(n)})),t.defineOption("enable-rich-mode",!1,(function(n,o,a){return r(this,void 0,void 0,(function*(){if(a&&a!=t.Init&&(n.off("change",g),n.off("update",u),n.off("mousedown",d),n.off("renderLine",l),s.remove(n),n.state.richMarkdown=null,i.clearAllWidgets(n),clearInterval(this.state.richMarkdown.scanImgInterval)),o){setTimeout((function t(i){return r(this,void 0,void 0,(function*(){const o=yield function(){return r(this,void 0,void 0,(function*(){return yield e.postMessage({name:"getSettings"})}))}();o?n.initializeRichMarkdown(o):setTimeout(t,2*i,2*i)}))}),50,100)}}))}))},codeMirrorResources:["addon/selection/active-line","addon/selection/mark-selection"],codeMirrorOptions:{"enable-rich-mode":!0,styleSelectedText:!0},assets:function(){return[{mime:"text/css",inline:!0,text:".cm-rm-monospace {\n\t\t\t\t\t\t\t\t\t\t\tfont-family: monospace !important;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t.cm-rm-ins {\n\t\t\t\t\t\t\t\t\t\t\ttext-decoration: underline;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t.cm-rm-sub {\n\t\t\t\t\t\t\t\t\t\t\tvertical-align: sub;\n\t\t\t\t\t\t\t\t\t\t\tfont-size: smaller;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t.cm-rm-sup {\n\t\t\t\t\t\t\t\t\t\t\tvertical-align: super;\n\t\t\t\t\t\t\t\t\t\t\tfont-size: smaller;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t.CodeMirror-selectedtext.cm-search-marker {\n\t\t\t\t\t\t\t\t\t\t\tbackground-color: #e5d3ce;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t/* Needed for the renderLine indent hack to work */\n\t\t\t\t\t\t\t\t\t\t.CodeMirror pre > * { text-indent: 0px; }\n\t\t\t\t\t\t\t"}]}}}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.clearAllWidgets=t.refreshAllWidgets=t.afterSourceChanges=t.onSourceChanged=t.html_image_line_regex=t.image_inline_regex=t.image_line_regex=void 0;const i=n(1),o=n(0);function s(e){return function(n){return r(this,void 0,void 0,(function*(){if(!n.target)return;if(!e.state.richMarkdown)return;if(!e.state.richMarkdown.settings.imageHover)return;if(!e.state.richMarkdown.settings.imageHoverCtrl&&(!n.ctrlKey&&!n.altKey||e.state.richMarkdown.isMouseHovering))return;e.state.richMarkdown.isMouseHovering=!0;const s=n.target;if(!s.offsetParent)return;if(e.state.richMarkdown.settings.inlineImages&&s.parentNode.childNodes.length<=3)return;const a=yield function(e,n){return r(this,void 0,void 0,(function*(){let{line:r,ch:s}=n;const a=e.getLine(r),c=i.getMatchAt(a,t.image_inline_regex,s);let u=null;if(c)u=yield g(c[2],c[1],e.state.richMarkdown.path_from_id);else{const t=i.getMatchAt(a,o.html_image_regex,s);t&&(u=yield l(t[0],e.state.richMarkdown.path_from_id))}return u}))}(e,i.getClickCoord(e,n));if(a){if(a.style.zoom){let e=parseFloat(a.style.zoom);a.style.zoom.endsWith("%")&&(e/=100),e&&(a.width*=e,a.height*=e,a.style.zoom="100%")}a.style.visibility="hidden",s.offsetParent.appendChild(a),a.style.position="absolute",a.style.zIndex="1000",a.classList.add("rich-markdown-hover-image"),a.onload=function(){if(!e.state.richMarkdown)return;if(!e.state.richMarkdown.isMouseHovering)return void a.remove();let t=this;const r=s.offsetParent,{right:i,width:o}=r.getBoundingClientRect();let c=0;t.clientWidth<o&&(c=Math.min(n.clientX,i-t.clientWidth));const l=e.coordsChar({left:c,top:n.clientY},"page");t.style.visibility="visible",e.addWidget(l,a,!1)}}}))}}function a(e){const t=e.getWrapperElement().getElementsByClassName("rich-markdown-hover-image");for(let e=t.length-1;e>=0;e--)t[e].remove()}function c(e){return function(t){e.state.richMarkdown&&(e.state.richMarkdown.isMouseHovering=!1),a(e)}}function l(e,t){return r(this,void 0,void 0,(function*(){const n=(new DOMParser).parseFromString(e,"text/html").body.firstChild;n.style.height=n.style.height||"auto",n.style.maxWidth=n.style.maxWidth||"100%";const r=["script","noscript","iframe","frameset","frame","object","base","embed","link","meta"];for(let e=0;e<n.attributes.length;e++){const t=n.attributes[e].name;(r.includes(t)||t.startsWith("on"))&&(n.attributes[e].value="")}if(n.src.length>=34){const e=n.src.substring(n.src.length-34);e.startsWith(":/")&&(n.src=yield t(e.substring(2)))}return n}))}function g(e,t,n){return r(this,void 0,void 0,(function*(){e.startsWith(":/")&&34==e.length&&(e=yield n(e.substring(2))),e.startsWith("<")&&e.endsWith(">")&&(e=e.substring(1,e.length-1));const r=document.createElement("img");return r.src=e,r.alt=t,r.style.maxWidth="100%",r.style.height="auto",r}))}function u(e){const t=e.getScrollInfo();for(let n=e.firstLine();n<=e.lastLine();n++){const r=e.lineInfo(n),i=(new Date).getTime();let o="";if(r.widgets)for(const n of r.widgets)if("rich-markdown-resource"===n.className){o=n.node.src.split("?t=")[0];const r=n.node.width,s=n.node.height;n.node.onload=function(){this.clientWidth==r&&this.clientHeight==s||(e.refresh(),e.scrollTo(t.left,t.top))},n.node.src=`${o}?t=${i}`}}}t.image_line_regex=/^\s*!\[([^\]]*)\]\((<[^\)]+>|[^)\s]+)[^)]*\)\s*$/,t.image_inline_regex=/!\[([^\]]*)\]\((<[^\)]+>|[^)\s]+)[^)]*\)/g,t.html_image_line_regex=/^\s*<img([^>]+?)\/?>\s*$/,t.onSourceChanged=function(e,n,i){e.state.richMarkdown&&e.state.richMarkdown.settings.inlineImages&&(!function(e,n,i){var o,s,a;r(this,void 0,void 0,(function*(){if(!e.state.richMarkdown)return;const r=e.getScrollInfo(),c=e.state.richMarkdown.path_from_id;for(let u=n;u<=i;u++){const n=e.lineInfo(u);if(n.widgets)for(const e of n.widgets)"rich-markdown-resource"===e.className&&e.clear();if(!n)continue;const i=e.getStateAfter(u,!0);if((null==i?void 0:i.outer)&&((null===(o=null==i?void 0:i.outer)||void 0===o?void 0:o.code)||(null===(a=null===(s=null==i?void 0:i.outer)||void 0===s?void 0:s.thisLine)||void 0===a?void 0:a.fencedCodeEnd)))continue;const d=n.text.match(t.image_line_regex);let h=null;if(d)h=yield g(d[2],d[1],c);else{const e=n.text.match(t.html_image_line_regex);e&&(h=yield l(e[0],c))}if(h){h.onload=function(){e.refresh(),e.scrollTo(r.left,r.top)};e.addLineWidget(u,h,{className:"rich-markdown-resource"})}}}))}(e,n,i),u(e))},t.afterSourceChanges=function(e){e.state.richMarkdown&&e.state.richMarkdown.settings.imageHover&&function(e){if(!e.state.richMarkdown)return;const t=e.getWrapperElement().getElementsByClassName("cm-rm-image");for(let n of t)n.onmouseenter=s(e),n.onmouseleave=c(e),e.state.richMarkdown.settings.imageHoverCtrl||(n.onmousemove=s(e))}(e)},t.refreshAllWidgets=u,t.clearAllWidgets=function(e){a(e);for(let t=e.firstLine();t<=e.lastLine();t++){const n=e.lineInfo(t);if(n.widgets)for(const e of n.widgets)"rich-markdown-resource"===e.className&&e.clear()}e.refresh()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onRenderLine=t.calculateSpaceWidth=void 0;const r=n(0);let i=0,o=0,s=0;function a(e,t,n){let r=document.createElement("span");n&&r.classList.add(n),r.style.whiteSpace="pre-wrap",r.appendChild(document.createTextNode(t.repeat(10)));const i=e.getWrapperElement().getElementsByClassName("CodeMirror-measure")[0];i.firstChild&&i.removeChild(i.firstChild),i.appendChild(r);const o=r.getBoundingClientRect();return(o.right-o.left)/10||e.defaultCharWidth()}t.calculateSpaceWidth=function(e){i=a(e," ",""),o=a(e," ","cm-rm-monospace"),s=a(e,">","")},t.onRenderLine=function(e,t,n,a){if(e.state.richMarkdown&&e.state.richMarkdown.settings.alignIndent){const c=t.text.match(r.list_token_regex);if(!c)return;let l=a.countColumn(t.text,c[0].length,e.getOption("tabSize"))*i;e.state.richMarkdown.settings.enforceMono&&c[0].indexOf("[")>0?l+=6*o-6*i:e.state.richMarkdown.settings.enforceMono&&c[0].indexOf(">")>=0&&(l+=s-i),n.style.textIndent="-"+l+"px",n.style.paddingLeft=l+"px"}}}]).default;